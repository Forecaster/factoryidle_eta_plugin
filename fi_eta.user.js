// ==UserScript==
// @name         FactoryIdle eta display
// @namespace    https://github.com/Forecaster/factoryidle_eta_plugin
// @version      0.6
// @description  A plugin for FactoryIdle.com that displays time until a money goal is reached based on current income
// @author       Forecaster
// @match        http://factoryidle.com/
// @grant        none
// ==/UserScript==
(function(){var k="FactoryIdle eta display";function f(b){console.info("["+k+"] "+b)}f("Script Loaded");var v=[{id:"thousand",power:1000,keywords:["K","k","kilo","thousand","tho"]},{id:"million",power:1000000,keywords:["M","m","mega","million","mil"]},{id:"billion",power:1000000000,keywords:["G","g","giga","b","billion","bil"]},{id:"trillion",power:1000000000000,keywords:["T","t","tera","trillion","tri"]},{id:"quadrillion",power:1000000000000000,keywords:["P","p","peta","quadrillion","qua"]},{id:"quintillion",power:1000000000000000000,keywords:["E","e","exa","quintillion","qui"]},{id:"sextillion",power:1e+21,keywords:["Z","z","zetta","sextillion","sex"]}];if(!String.prototype.format){String.prototype.format=function(){var b=arguments;return this.replace(/{(\d+)}/g,function(i,J){return typeof b[J]!="undefined"?b[J]:i})}}function j(b){return !(typeof b=="undefined"||b===null)}function H(b){return G(b*1000)}function G(J){var M=J;if(J<0){J=J*-1}var O=J/1000;var L=Math.floor(O/60/60/24/30/12);O=O-(L*12*30*24*60*60);var i=Math.floor(O/60/60/24/30);O=O-(i*30*24*60*60);var b=Math.floor(O/60/60/24/7);O=O-(b*7*24*60*60);var P=Math.floor(O/60/60/24);O=O-(P*24*60*60);var N=Math.floor(O/60/60);O=O-(N*60*60);var K=Math.floor(O/60);O=O-(K*60);return{years:L,months:i,weeks:b,days:P,hours:N,minutes:K,seconds:Math.floor(O),input:M}}function h(K,J,N){var M="";var b=[];if(!j(N)){N=6}if(j(J)&&J){if(K.years>0){b.push(K.years+"y, ")}if(K.months>0){b.push(K.months+"m, ")}if(K.weeks>0){b.push(K.weeks+"w, ")}if(K.days>0){b.push(K.days+"d, ")}if(K.hours>0){b.push(K.hours+"h, ")}if(K.minutes>0){b.push(K.minutes+"m, ")}if(K.seconds>0){b.push(K.seconds+"s, ")}}else{if(K.years>0){b.push((K.years==1)?K.years+" year, ":K.years+" years, ")}if(K.months>0){b.push((K.months==1)?K.months+" month, ":K.months+" months, ")}if(K.weeks>0){b.push((K.weeks==1)?K.weeks+" week, ":K.weeks+" weeks, ")}if(K.days>0){b.push((K.days==1)?K.days+" day, ":K.days+" days, ")}if(K.hours>0){b.push((K.hours==1)?K.hours+" hour, ":K.hours+" hours, ")}if(K.minutes>0){b.push((K.minutes==1)?K.minutes+" minute, ":K.minutes+" minutes, ")}if(K.seconds>0){b.push((K.seconds==1)?K.seconds+" second, ":K.seconds+" seconds, ")}}for(var L=0;L<N&&L<b.length;L++){M+=b[L]}M=M.replace(/, $/,"");if(M.length===0){M="<0"}return M}function s(K){var J=K.target.getAttribute("data-setting");var i=K.target.getAttribute("data-setting-sub");var b=K.target.getAttribute("data-disabled");if(typeof b=="undefined"||b===null){b=false}if(typeof J=="undefined"||J===null||b=="true"){y[i][J]=K.target.checked}}function c(b){if(b.target.value=="top_left"){n.style.top="20px";n.style.left="20px";n.style.right=null;n.style.bottom=null}else{if(b.target.value=="top_right"){n.style.top="20px";n.style.left=null;n.style.right="20px";n.style.bottom=null}else{if(b.target.value=="bottom_left"){n.style.top=null;n.style.left="20px";n.style.right=null;n.style.bottom="20px"}else{if(b.target.value=="bottom_right"){n.style.top=null;n.style.left=null;n.style.right="20px";n.style.bottom="2opx"}}}}}var y={money:{generate_timer_link:true},research:{generate_timer_link:true}};var n=document.createElement("div");n.style.position="absolute";n.style.top="20px";n.style.right="20px";var p=document.createElement("div");var e=document.createElement("select");e.onchange=c;e.innerHTML="<option value='top_left'>Top Left</option><option value='top_right'>Top Right</option><option value='bottom_left'>Bottom Left</option><option value='bottom_right'>Bottom Right</option>";p.appendChild(e);var C=document.createElement("div");C.style.backgroundColor="white";C.style.color="black";C.style.padding="10px";C.style.border="4px solid orange";var u=document.createElement("div");u.id="calc_money_display";var g=document.createElement("div");g.id="calc_money_timer_link";var D=document.createElement("div");D.innerHTML="<input id='calc_money_goal' placeholder='Target (eg 5 mil or 5 million)' />";var o=document.createElement("div");o.innerHTML="<label style='cursor: pointer'><input type='checkbox' checked data-setting-sub='money' data-disabled='true' data-setting='use_total_average' class='setting' style='cursor: pointer' title='Uses total average, which fluctuates a lot less.'/> Use Total Avg</label>";var m=document.createElement("div");m.innerHTML="<label style='cursor: pointer'><input type='checkbox' checked data-setting-sub='money' data-setting='calculate_average' class='setting' style='cursor: pointer' title='Calculates averages from the total of the individual incomes to fluctuate less while still being more accurate. Does not affect \"Use Total Avg\"'/> Calculate Average</label>";var l=document.createElement("div");l.innerHTML="<label style='cursor: pointer'><input type='checkbox' checked data-setting-sub='money' data-disabled='true' data-setting='generate_timer_link' class='setting' style='cursor: pointer' title='Generates a link to a third party timer that counts down to your goal.'/> Generate Timer Link</label>";var B=document.createElement("div");B.style.backgroundColor="white";B.style.color="black";B.style.padding="10px";B.style.border="4px solid lightblue";var a=document.createElement("div");a.id="calc_research_display";var t=document.createElement("div");t.id="calc_research_timer_link";var q=document.createElement("div");q.innerHTML="<input id='calc_research_goal' placeholder='Target (eg 5 mil or 5 million)' />";var F=document.createElement("div");F.innerHTML="<label style='cursor: pointer'><input type='checkbox' checked data-setting-sub='research' data-disabled='true' data-setting='use_total_average' class='setting' style='cursor: pointer' title='Uses total average, which fluctuates a lot less.'/> Use Total Avg</label>";var E=document.createElement("div");E.innerHTML="<label style='cursor: pointer'><input type='checkbox' checked data-setting-sub='research' data-setting='calculate_average' class='setting' style='cursor: pointer' title='Calculates averages from the total of the individual incomes to fluctuate less while still being more accurate. Does not affect \"Use Total Avg\"'/> Calculate Average</label>";var A=document.createElement("div");A.innerHTML="<label style='cursor: pointer'><input type='checkbox' checked data-setting-sub='research' data-disabled='true' data-setting='generate_timer_link' class='setting' style='cursor: pointer' title='Generates a link to a third party timer that counts down to your goal.'/> Generate Timer Link</label>";C.appendChild(D);C.appendChild(u);C.appendChild(g);C.appendChild(l);B.appendChild(q);B.appendChild(a);B.appendChild(t);B.appendChild(A);n.appendChild(p);n.appendChild(C);n.appendChild(B);document.body.appendChild(n);var d="https://duckduckgo.com/?q=timer+{0}+seconds&ia=timer";var x=0;var I=0;function r(K,M){if(typeof K=="undefined"||K===null){K="money"}if(typeof M=="undefined"||M===null){M=document.getElementById("calc_money_display")}else{M=document.getElementById(M)}var U;if(K=="money"){U=document.getElementById("calc_money_timer_link")}else{if(K=="research"){U=document.getElementById("calc_research_timer_link")}}if(document.getElementById("factorySelection")!==null){var R=document.getElementById("calc_"+K+"_goal").value;if(R===""){M.innerHTML="No target set";return}R=R.replace(",","");R=R.replace(" ","");var Y=/[\d\.]*([a-zA-Z]*)/;var J=1;var L=R.match(Y);if(L.length==2){L=L[1];for(var O=0;O<v.length;O++){if(v[O].keywords.indexOf(L)>=0){J=v[O].power;O=100000}}}R=parseFloat(R)*J;var W=document.getElementById("ticks").innerHTML;var b;if(K=="money"){b=document.getElementById("money").innerHTML}else{if(K=="research"){b=document.getElementById("researchPoints").innerHTML}}b=b.replace(" ","");J=1;L=b.match(Y);if(L.length==2){L=L[1];for(var P=0;P<v.length;P++){if(v[P].keywords.indexOf(L)>=0){J=v[P].power;P=1000000}}}b=parseFloat(b)*J;var Q=document.getElementsByClassName(K);I=0;for(O=2;O<Q.length;O++){var T=Q[O].innerHTML.replace(" ","").replace("+","");if(T>0){var S=I;I=parseFloat(I)+parseFloat(T)}}var X=W*I;var N=R-b;if(!isNaN(N)){if(N>0){var V=N/X;M.innerHTML=h(H(V),true,2);U.innerHTML="<a href='"+d.format(V)+"'>Timer</a>"}else{M.innerHTML="Goal reached!"}}else{M.innerHTML="Unable to calculate goal"}}else{M.innerHTML="Go to overview"}}var w=document.getElementsByClassName("setting");for(var z=0;z<w.length;z++){w[z].onchange=s}f("Register interval");setInterval(function(){r("money","calc_money_display")},1000);setInterval(function(){r("research","calc_research_display")},1000)})();